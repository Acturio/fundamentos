[
["index.html", "EST-46111: Fundamentos de Estadística con Remuestreo Información del curso Temario Evaluación", " EST-46111: Fundamentos de Estadística con Remuestreo Teresa Ortiz (001), Alfredo Garbuno (002), Felipe González Información del curso Notas del curso Fundamentos de Estadística con Remuestreo del programa de maestría en Ciencia de Datos del ITAM. En caso de encontrar errores o tener sugerencias del material se agradece la propuesta de correcciones mediante pull requests. Ligas Notas: https://fundamentos.netlify.app/ Correos: teresa.ortiz.mancera@gmail.com, alfredo.garbuno@itam.mx. GitHub: https://github.com/tereom/fundamentos Foros de discusion: - Grupo Teresa: slack - Grupo Alfredo: canvas Este trabajo está bajo una Licencia Creative Commons Atribución 4.0 Internacional. Temario Datos y análisis exploratorio Referencias: (Cleveland 1993), (Chihara and Hesterberg 2018) Visualización y análisis exploratorio Tipos de datos o estudios Muestras diseñadas y muestras naturales Experimentos y datos observacionales Introducción a Pruebas de Hipótesis Referencias: (Chihara and Hesterberg 2018) Introducción a pruebas de hipótesis. Pruebas de permutaciones Muestras pareadas y otros ejemplos Estimación y distribución de muestreo Referencias: (Chihara and Hesterberg 2018), (Hesterberg 2015) Estimadores y su distribución de muestreo Repaso de probabilidad y Teorema del límite central Introducción a estimación por intervalos Referencias: (Chihara and Hesterberg 2018), (Efron and Tibshirani 1993), (Hesterberg 2015) El método plugin y el boostrap Bootstrap e Intervalos de confianza. Ejemplos. Estimación Referencias: (Chihara and Hesterberg 2018), (Wasserman 2013) Estimación por máxima verosimilitud Ejemplos de estimación por máxima verosimilitud y Bootstrap paramétrico Propiedades de estimadores de máxima verosimilitud Más de pruebas de hipótesis Referencias: (Chihara and Hesterberg 2018), (Wasserman 2013) Pruebas de hipótesis para medias y proporciones: una y dos poblaciones. Introducción a inferencia bayesiana Referencias: (Kruschke 2015) Introducción a inferencia bayesiana Ejemplos de distribuciones conjugadas Introducción a métodos computacionales básicos: Muestreadores Metrópolis y Gibbs Evaluación Tareas semanales 20% Parcial teórico + parcial a casa 40% Final a casa 40% Referencias "],
["analisis-exploratorio-y-visualizacion.html", "Sección 1 Analisis exploratorio y visualizacion El papel de la exploración en el análisis de datos Algunos conceptos básicos Ejemplos Interpretación", " Sección 1 Analisis exploratorio y visualizacion “Exploratory data analysis can never be the whole story, but nothing else can serve as the foundation stone –as the first step.” — John Tukey “The simple graph has brought more information to the data analyst’s mind than any other device.” — John Tukey El papel de la exploración en el análisis de datos El estándar científico para contestar preguntas o tomar decisiones es uno que se basa en el análisis de datos. Es decir, en primer lugar se deben reunir todos los datos disponibles que puedan contener o sugerir alguna guía para entender mejor la pregunta o la decisión a la que nos enfrentamos. Esta recopilación de datos —que pueden ser cualitativos, cuantitativos, o una mezcla de los dos— debe entonces ser analizada para extraer información relevante para nuestro problema. En análisis de datos existen dos distintos tipos de trabajo: El trabajo exploratorio o de detective: ¿cuáles son los aspectos importantes de estos datos? ¿qué indicaciones generales muestran los datos? ¿qué tareas de análisis debemos empezar haciendo? ¿cuáles son los caminos generales para formular con precisión y contestar algunas preguntas que nos interesen? El trabajo inferencial, confirmatorio, o de juez: ¿cómo evaluar el peso de la evidencia de los descubrimientos del paso anterior? ¿qué tan bien soportadas están las respuestas y conclusiones por nuestro conjunto de datos? Algunos conceptos básicos Empezamos explicando algunas ideas que no serán útiles más adelante. Por ejemplo, los siguientes datos fueron registrados en un restaurante durante cuatro días consecutivos: library(tidyverse) library(patchwork) source(&quot;R/funciones_auxiliares.R&quot;) # usamos los datos tips del paquete reshape2 tips &lt;- reshape2::tips # renombramos variables y niveles propinas &lt;- tips %&gt;% rename(cuenta_total = total_bill, propina = tip, sexo = sex, fumador = smoker, dia = day, momento = time, num_personas = size) %&gt;% mutate(sexo = recode(sexo, Female = &quot;Mujer&quot;, Male = &quot;Hombre&quot;), fumador = recode(fumador, No = &quot;No&quot;, Si = &quot;Si&quot;), dia = recode(dia, Sun = &quot;Dom&quot;, Sat = &quot;Sab&quot;, Thur = &quot;Jue&quot;, Fri = &quot;Vie&quot;), momento = recode(momento, Dinner = &quot;Cena&quot;, Lunch = &quot;Comida&quot;)) %&gt;% select(-sexo) %&gt;% mutate(dia = fct_relevel(dia, c(&quot;Jue&quot;, &quot;Vie&quot;, &quot;Sab&quot;, &quot;Dom&quot;))) Y vemos una muestra sample_n(propinas, 10) ## cuenta_total propina fumador dia momento num_personas ## 1 19.49 3.51 No Dom Cena 2 ## 2 24.55 2.00 No Dom Cena 4 ## 3 10.07 1.83 No Jue Comida 1 ## 4 35.26 5.00 No Dom Cena 4 ## 5 14.73 2.20 No Sab Cena 2 ## 6 28.44 2.56 Yes Jue Comida 2 ## 7 13.94 3.06 No Dom Cena 2 ## 8 22.49 3.50 No Vie Cena 2 ## 9 11.24 1.76 Yes Sab Cena 2 ## 10 16.99 1.01 No Dom Cena 2 Aquí la unidad de observación es una cuenta particular. Tenemos tres mediciones numéricas de cada cuenta: cúanto fue la cuenta total, la propina, y el número de personas asociadas a la cuenta. Los datos están separados según se fumó o no en la mesa, y temporalmente en dos partes: el día (Jueves, Viernes, Sábado o Domingo), cada uno separado por Cena y Comida. Denotamos por \\(x\\) el valor de medición de una unidad de observación. Usualmente utilizamos sub-índices para identificar entre diferentes puntos de datos (observaciones), por ejemplo, \\(x_n\\) para la \\(n-\\)ésima observación. De tal forma que una colección de \\(N\\) observaciones la escribimos como \\[\\begin{align} \\{x_1, \\ldots, x_N\\}. \\end{align}\\] El primer tipo de comparaciones que nos interesa hacer es para una medición: ¿Varían mucho o poco los datos de un tipo de medición? ¿Cuáles son valores típicos o centrales? ¿Existen valores atípicos? Supongamos entonces que consideramos simplemente la variable de cuenta_total. Podemos comenzar por ordenar los datos, y ver cuáles datos están en los extremos y cuáles están en los lugares centrales: En general la colección de datos no está ordenada por sus valores. Esto es debido a que las observaciones en general se recopilan de manera aleatoria. Utilizamos la notación de \\(\\sigma(n)\\) para denotar un reordenamiento de los datos de tal forma \\[ \\{x_{\\sigma(1)}, \\ldots, x_{\\sigma(N)}\\}, \\] y que satisface la siguiente serie de desigualdades \\[ x_{\\sigma(1)} \\leq \\ldots \\leq x_{\\sigma(N)}. \\] propinas &lt;- propinas %&gt;% mutate(orden_cuenta = rank(cuenta_total, ties.method = &quot;first&quot;), f = (orden_cuenta - 0.5) / n()) cuenta &lt;- propinas %&gt;% select(orden_cuenta, f, cuenta_total) %&gt;% arrange(f) bind_rows(head(cuenta), tail(cuenta)) %&gt;% knitr::kable() orden_cuenta f cuenta_total 1 0.0020492 3.07 2 0.0061475 5.75 3 0.0102459 7.25 4 0.0143443 7.25 5 0.0184426 7.51 6 0.0225410 7.56 239 0.9774590 44.30 240 0.9815574 45.35 241 0.9856557 48.17 242 0.9897541 48.27 243 0.9938525 48.33 244 0.9979508 50.81 También podemos graficar los datos en orden, interpolando valores consecutivos. A esta función le llamamos la función de cuantiles para la variable cuenta_total. Nos sirve para comparar directamente los distintos valores que observamos los datos según el orden que ocupan. La función de cuantiles muestral esta definida por \\[ \\hat{F}(x) = \\frac1N \\sum_{n = 1}^N \\mathbb{1}\\{x_n \\leq x\\}, \\] donde la funcion indicadora está definida por \\[ 1\\{ x \\leq t\\} = \\begin{cases} 1, \\text{ si } x \\leq t \\\\ 0, \\text{ en otro caso} \\end{cases}. \\] El cuantil \\(p\\) es el valor \\(x = x(p)\\), esta notación sirve para definir \\(x\\) como una función de \\(p,\\) tal que \\[ \\hat F(x) = p. \\] Es decir, \\(x\\) acumula el \\(p\\)-% de los casos. Para una medición de interés \\(x\\) con posibles valores en el intervalo \\([a, b]\\). Comprueba que \\(\\hat F(a) = 0\\) y \\(\\hat F(b) = 1\\) para cualquier colección de datos de tamaño \\(N.\\) La gráfica anterior, también nos sirve para poder estudiar la dispersión y valores centrales de los datos observados. Por ejemplo, podemos notar que: El rango de datos va de unos 3 dólares hasta 50 dólares Los valores centrales —del cuantil 0.25 al 0.75, por decir un ejemplo— están entre unos 13 y 25 dólares El cuantil 0.5 (o también conocido como mediana) está alrededor de 18 dólares. ¿Cómo definirías la mediana en términos de la función de cuantiles? Pista: Considera los casos por separado para \\(N\\) impar o par. Éste último puede ser utilizado para dar un valor central de la distribución de valores para cuenta_total. Asimismo podemos dar resúmenes más refinados si es necesario. Por ejemplo, podemos reportar que: El cuantil 0.95 es de unos 35 dólares — sólo 5% de las cuentas son de más de 35 dólares El cuantil 0.05 es de unos 8 dólares — sólo 5% de las cuentas son de 8 dólares o menos. Finalmente, la forma de la gráfica se interpreta usando su pendiente (tasa de cambio) haciendo comparaciones en diferentes partes de la gráfica: La distribución de valores tiene asimetría: el 10% de las cuentas más altas tiene considerablemente más dispersión que el 10% de las cuentas más bajas. Entre los cuantiles 0.2 y 0.5 es donde existe mayor densidad de datos: la pendiente (tasa de cambio) es alta, lo que significa que al avanzar en los valores observados, los cuantiles (el porcentaje de casos) aumenta rápidamente. Cuando la pendiente es casi plana, quiere decir que los datos tienen más dispersión local o están más separados. En algunos casos, es más natural hacer un histograma, donde dividimos el rango de la variable en cubetas o intervalos (en este caso de igual longitud), y graficamos por medio de barras cuántos datos caen en cada cubeta: Es una gráfica más popular, pero perdemos cierto nivel de detalle, y distintas particiones resaltan distintos aspectos de los datos. Finalmente, una gráfica más compacta que resume la gráfica de cuantiles o el histograma es el diagrama de caja y brazos. Mostramos dos versiones, la clásica de Tukey (T) y otra versión menos común de Spear/Tufte (ST): library(ggthemes) cuartiles &lt;- quantile(cuenta$cuenta_total) cuartiles ## 0% 25% 50% 75% 100% ## 3.0700 13.3475 17.7950 24.1275 50.8100 g_1 &lt;- ggplot(cuenta, aes(x = f, y = cuenta_total)) + labs(subtitle = &quot;Gráfica de cuantiles: Cuenta total&quot;) + geom_hline(yintercept = cuartiles[2], colour = &quot;gray&quot;) + geom_hline(yintercept = cuartiles[3], colour = &quot;gray&quot;) + geom_hline(yintercept = cuartiles[4], colour = &quot;gray&quot;) + geom_point(alpha = 0.5) + geom_line() g_2 &lt;- ggplot(cuenta, aes(x = factor(&quot;ST&quot;, levels =c(&quot;ST&quot;)), y = cuenta_total)) + geom_tufteboxplot() + labs(subtitle = &quot; &quot;) + xlab(&quot;&quot;) + ylab(&quot;&quot;) g_3 &lt;- ggplot(cuenta, aes(x = factor(&quot;T&quot;), y = cuenta_total)) + geom_boxplot() + labs(subtitle = &quot; &quot;) + xlab(&quot;&quot;) + ylab(&quot;&quot;) g_4 &lt;- ggplot(cuenta, aes(x = factor(&quot;P&quot;), y = cuenta_total)) + geom_jitter(height = 0, width =0.2, alpha = 0.5) + labs(subtitle = &quot; &quot;) + xlab(&quot;&quot;) + ylab(&quot;&quot;) g_5 &lt;- ggplot(cuenta, aes(x = factor(&quot;V&quot;), y = cuenta_total)) + geom_violin() + labs(subtitle = &quot; &quot;) + xlab(&quot;&quot;) + ylab(&quot;&quot;) g_1 + g_2 + g_3 + g_4 + plot_layout(widths = c(8, 2, 2, 2)) Hasta ahora hemos utilizado la definición general de cuantiles. Donde consideramos el cuantil \\(q\\), para buscar \\(x\\) tal que \\(\\hat F(x) = q.\\) Hay valores típicos de interés que corresponden a \\(q\\) igual a 25%, 50% y 75%. Éstos valores se denominan cuartiles. Ventajas en el análisis inicial En un principio del análisis, estos resúmenes (cuantiles) pueden ser más útiles que utilizar medias y varianzas, por ejemplo. La razón es que los cuantiles: Son cantidades más fácilmente interpretables Los cuantiles centrales son más resistentes a valores atípicos que medias o varianzas Sin embargo, permite identificar valores extremos Es fácil comparar cuantiles de distintos bonches de datos Media y desviación estándar Las medidas más comunes de localización y dispersión para un conjunto de datos son la media muestral y la desviación estándar muestral. En general, no son muy apropiadas para iniciar el análisis exploratorio, pues: Son medidas más difíciles de interpretar y explicar que los cuantiles. En este sentido, son medidas especializadas. Por ejemplo, intenta explicar intuitivamente qué es la media. No son resistentes a valores atípicos o erróneos. Su falta de resistencia los vuelve poco útiles en las primeras etapas de limpieza y descripción. La media, o promedio, se denota por \\(\\bar x\\) y se define como \\[ \\bar x = \\frac1N \\sum_{n = 1}^N x_n. \\] La desviación estándar muestral se define como \\[ \\text{std}(x) = \\sqrt{\\frac1{N-1} \\sum_{n = 1}^N (x_n - \\bar x)^2}. \\] Sin embargo, La media y desviación estándar son computacionalmente convenientes. Para el trabajo de modelado estas medidas de resumen tienen ventajas claras (bajo ciertos supuestos teóricos). En muchas ocasiones conviene usar estas medidas pues permite hacer comparaciones históricas o tradicionales —pues análisis anteriores pudieran estar basados en éstas. Considera el caso de tener \\(N\\) observaciones y asume que ya tienes calculado el promedio para dichas observaciones. Este promedio lo denotaremos por \\(\\bar x_N\\). Ahora, considera que has obtenido \\(M\\) observaciones más. Escribe una fórmula recursiva para la media del conjunto total de datos \\(\\bar x_{N+M}\\) en función de lo que ya tenías precalculado \\(\\bar x_N.\\) ¿En qué situaciones esta propiedad puede ser conveniente? Ejemplos Precios de casas En este ejemplo consideremos los datos de precios de ventas de la ciudad de Ames, Iowa. En particular nos interesa entender la variación del precio de las casas. Por este motivo calculamos los cuantiles que corresponden al 25%, 50% y 75% (cuartiles), así como el mínimo y máximo de los precios de las casas: quantile(casas %&gt;% pull(precio_miles)) ## 0% 25% 50% 75% 100% ## 37.9 132.0 165.0 215.0 755.0 Comprueba que el mínimo y máximo están asociados a los cuantiles 0% y 100%, respectivamente. Una posible comparación es considerar los precios y sus variación en función de zona de la ciudad en que se encuentra una vivienda. Podemos usar diagramas de caja y brazos para hacer una comparación burda de los precios en distintas zonas de la ciudad: ggplot(casas, aes(x = nombre_zona, y = precio_miles)) + geom_boxplot() + coord_flip() La primera pregunta que nos hacemos es cómo pueden variar las características de las casas dentro de cada zona. Para esto, podemos considerar el área de las casas. En lugar de graficar el precio, graficamos el precio por metro cuadrado, por ejemplo: ggplot(casas, aes(x = nombre_zona, y = precio_m2)) + geom_boxplot() + coord_flip() Podemos cuantificar la variación que observamos de zona a zona y la variación que hay dentro de cada una de las zonas. Una primera aproximación es observar las variación del precio al calcular la mediana dentro de cada zona, y después cuantificar por medio de cuantiles cómo varía la mediana entre zonas: casas %&gt;% group_by(nombre_zona) %&gt;% summarise(mediana_zona = median(precio_m2)) %&gt;% pull(mediana_zona) %&gt;% quantile %&gt;% round ## `summarise()` ungrouping output (override with `.groups` argument) ## 0% 25% 50% 75% 100% ## 963 1219 1298 1420 1725 Tratar con datos por segmento es una situación común en aplicaciones. Usualmente denotamos por \\[ x_{k, n} \\] a la \\(n\\)-ésima observación del \\(k\\)-ésimo grupo. Usualmente tenemos un universo de \\(K\\) posibles grupos y para cada grupo tenemos un total diferente de observaciones. Esto lo denotamos por \\(N_k\\), el número total de observaciones del grupo \\(k\\) para cualquier \\(k = 1, \\ldots, K.\\) El número total de muestras lo denotamos por \\(N\\), donde \\[ N = \\sum_{k=1}^K N_k. \\] Finalmente, nos puede interesar, como en el ejemplo, los promedios por grupo \\[ \\bar x_k = \\frac{1}{N_k} \\sum_{n = 1}^{N_k} x_{k, n}, \\] y contrastar contra el promedio total \\[ \\bar x = \\frac1K \\sum_{k = 1}^K \\bar x_k = \\frac1K \\sum_{k = 1}^K \\left( \\frac{1}{N_k} \\sum_{n = 1}^{N_k} x_{k, n} \\right). \\] Por otro lado, las variaciones con respecto a las medianas dentro de cada zona, por grupo, se resume como: quantile(casas %&gt;% group_by(nombre_zona) %&gt;% mutate(residual = precio_m2 - median(precio_m2)) %&gt;% pull(residual)) %&gt;% round ## 0% 25% 50% 75% 100% ## -765 -166 0 172 1314 Nótese que este último paso tiene sentido pues la variación dentro de las zonas, en términos de precio por metro cuadrado, es similar. Esto no lo podríamos haber hecho de manera efectiva si se hubiera utilizado el precio de las casas sin ajustar por su tamaño. Vemos que la mayor parte de la variación del precio por metro cuadrado ocurre dentro de cada zona, una vez que controlamos por el tamaño de las casas. La variación dentro de cada zona es aproximadamente simétrica, aunque la cola derecha es ligeramente más larga con algunos valores extremos. Podemos seguir con otro indicador importante: la calificación de calidad de los terminados de las casas. Como primer intento podríamos hacer: Lo que indica que las calificaciones de calidad están distribuidas de manera muy distinta a lo largo de las zonas, y que probablemente no va ser simple desentrañar qué variación del precio se debe a la zona y cuál se debe a la calidad. Prueba Enlace Consideremos la prueba Enlace (2011) de matemáticas para primarias. Una primera pregunta que alguien podría hacerse es: ¿cuáles escuelas son mejores en este rubro, las privadas o las públicas? enlace_tbl &lt;- enlace %&gt;% group_by(tipo) %&gt;% summarise(n_escuelas = n(), cuantiles = list(cuantil(mate_6, c(0.05, 0.25, 0.5, 0.75, 0.95)))) %&gt;% unnest(cols = cuantiles) %&gt;% mutate(valor = round(valor)) enlace_tbl %&gt;% spread(cuantil, valor) %&gt;% formatear_tabla() tipo n_escuelas 0.05 0.25 0.5 0.75 0.95 Indígena/Conafe 13599 304 358 412 478 588 General 60166 380 454 502 548 631 Particular 6816 479 551 593 634 703 Para un análisis exploratorio podemos utilizar distintas gráficas. Por ejemplo, podemos utilizar nuevamente las gráficas de caja y brazos, así como graficar los percentiles. Nótese que en la gráfica 1 se utilizan los cuantiles 0.05, 0.25, 0.5, 0.75 y 0.95: Se puede discutir qué tan apropiada es cada gráfica con el objetivo de realizar comparaciones. Sin duda, graficar más cuantiles es más útil para hacer comparaciones. Por ejemplo, en la Gráfica 1 podemos ver que la mediana de las escuelas generales está cercana al cuantil 5% de las escuelas particulares. Por otro lado, el diagrama de caja y brazos muestra también valores “atípicos”. Es importante notar que una comparación más robusta se puede lograr por medio de pruebas de hipótesis, las cuales veremos mas adelante en el curso. Regresando a nuestro análisis exploratorio, notemos que la diferencia es considerable entre tipos de escuela. Antes de contestar prematuramente la pregunta: ¿cuáles son las mejores escuelas? busquemos mejorar la interpretabilidad de nuestras comparaciones usando los principios 2 y 3. Podemos comenzar por agregar, por ejemplo, el nivel del marginación del municipio donde se encuentra la escuela. Para este objetivo, podemos usar páneles (pequeños múltiplos útiles para hacer comparaciones) y graficar: Esta gráfica pone en contexto la pregunta inicial, y permite evidenciar la dificultad de contestarla. En particular: Señala que la pregunta no sólo debe concentarse en el tipo de “sistema”: pública, privada, etc. Por ejemplo, las escuelas públicas en zonas de marginación baja no tienen una distribución de calificaciones muy distinta a las privadas en zonas de marginación alta. El contexto de la escuela es importante. Debemos de pensar qué factores –por ejemplo, el entorno familiar de los estudiantes– puede resultar en comparaciones que favorecen a las escuelas privadas. Un ejemplo de esto es considerar si los estudiantes tienen que trabajar o no. A su vez, esto puede o no ser reflejo de la calidad del sistema educativo. Si esto es cierto, entonces la pregunta inicial es demasiado vaga y mal planteada. Quizá deberíamos intentar entender cuánto “aporta” cada escuela a cada estudiante, como medida de qué tan buena es cada escuela. Estados y calificaciones en SAT ¿Cómo se relaciona el gasto por alumno, a nivel estatal, con sus resultados académicos? Hay trabajo considerable en definir estos términos, pero supongamos que tenemos el siguiente conjunto de datos (Guber 1999), que son datos oficiales agregados por estado de Estados Unidos. Consideremos el subconjunto de variables sat, que es la calificación promedio de los alumnos en cada estado (para 1997) y expend, que es el gasto en miles de dólares por estudiante en (1994-1995). sat &lt;- read_csv(&quot;data/sat.csv&quot;) sat_tbl &lt;- sat %&gt;% select(state, expend, sat) %&gt;% gather(variable, valor, expend:sat) %&gt;% group_by(variable) %&gt;% summarise(cuantiles = list(cuantil(valor))) %&gt;% unnest(cols = c(cuantiles)) %&gt;% mutate(valor = round(valor, 1)) %&gt;% spread(cuantil, valor) sat_tbl %&gt;% formatear_tabla variable 0 0.25 0.5 0.75 1 expend 3.7 4.9 5.8 6.4 9.8 sat 844.0 897.2 945.5 1032.0 1107.0 Esta variación es considerable para promedios del SAT: el percentil 75 es alrededor de 1050 puntos, mientras que el percentil 25 corresponde a alrededor de 800. Igualmente, hay diferencias considerables de gasto por alumno (miles de dólares) a lo largo de los estados. Ahora hacemos nuestro primer ejercico de comparación: ¿Cómo se ven las calificaciones para estados en distintos niveles de gasto? Podemos usar una gráfica de dispersión: library(ggrepel) ggplot(sat, aes(x = expend, y = sat, label = state)) + geom_point(colour = &quot;red&quot;, size = 2) + geom_text_repel(colour = &quot;gray50&quot;) + xlab(&quot;Gasto por alumno (miles de dólares)&quot;) + ylab(&quot;Calificación promedio en SAT&quot;) Estas comparaciones no son de alta calidad, solo estamos usando 2 variables —que son muy pocas— y no hay mucho que podamos decir en cuanto explicación. Sin duda nos hace falta una imagen más completa. Necesitaríamos entender la correlación que existe entre las demás características de nuestras unidades de estudio. Las unidades que estamos comparando pueden diferir fuertemente en otras propiedades importantes (aka, dimensiones), lo cual no permite interpretar la gráfica de manera sencilla. Sabemos que es posible que el IQ difiera en los estados. Pero no sabemos cómo producir diferencias de este tipo. Sin embargo, ¡descubrimos que existe una variable adicional! Ésta es el porcentaje de alumnos de cada estado que toma el SAT. Podemos agregar como sigue: ggplot(sat, aes(x = expend, y = math, label=state, colour = frac)) + geom_point() + geom_text_repel() + xlab(&quot;Gasto por alumno (miles de dólares)&quot;) + ylab(&quot;Calificación en matemáticas&quot;) Esto nos permite entender por qué nuestra comparación inicial es relativamente pobre. Los estados con mejores resultados promedio en el SAT son aquellos donde una fracción relativamente baja de los estudiantes toma el examen. La diferencia es considerable. En este punto podemos hacer varias cosas. Una primera idea es intentar comparar estados más similares en cuanto a la población de alumnos que asiste. Podríamos hacer grupos como sigue: set.seed(991) k_medias_sat &lt;- kmeans(sat %&gt;% select(frac), centers = 4, nstart = 100, iter.max = 100) sat$clase &lt;- k_medias_sat$cluster sat &lt;- sat %&gt;% group_by(clase) %&gt;% mutate(clase_media = round(mean(frac))) %&gt;% ungroup %&gt;% mutate(clase_media = factor(clase_media)) sat &lt;- sat %&gt;% mutate(rank_p = rank(frac, ties= &quot;first&quot;) / length(frac)) ggplot(sat, aes(x = rank_p, y = frac, label = state, colour = clase_media)) + geom_point(size = 2) Estos resultados indican que es más probable que buenos alumnos decidan hacer el SAT. Lo interesante es que esto ocurre de manera diferente en cada estado. Por ejemplo, en algunos estados era más común otro examen: el ACT. Si hacemos clusters de estados según el % de alumnos, empezamos a ver otra historia. Para esto, ajustemos rectas de mínimos cuadrados como referencia: Sin embargo, el resultado puede variar considerablemente si categorizamos de distintas maneras. Tablas de conteos Consideremos los siguientes datos de tomadores de té (del paquete FactoMineR (Lê et al. 2008)): tea &lt;- read_csv(&quot;data/tea.csv&quot;) # nombres y códigos te &lt;- tea %&gt;% select(how, price, sugar) %&gt;% rename(presentacion = how, precio = price, azucar = sugar) %&gt;% mutate( presentacion = fct_recode(presentacion, suelto = &quot;unpackaged&quot;, bolsas = &quot;tea bag&quot;, mixto = &quot;tea bag+unpackaged&quot;), precio = fct_recode(precio, marca = &quot;p_branded&quot;, variable = &quot;p_variable&quot;, barato = &quot;p_cheap&quot;, marca_propia = &quot;p_private label&quot;, desconocido = &quot;p_unknown&quot;, fino = &quot;p_upscale&quot;), azucar = fct_recode(azucar, sin_azúcar = &quot;No.sugar&quot;, con_azúcar = &quot;sugar&quot;)) sample_n(te, 10) ## [90m# A tibble: 10 x 3[39m ## presentacion precio azucar ## [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m ## [90m 1[39m mixto variable sin_azúcar ## [90m 2[39m suelto fino con_azúcar ## [90m 3[39m bolsas fino con_azúcar ## [90m 4[39m mixto variable sin_azúcar ## [90m 5[39m bolsas variable sin_azúcar ## [90m 6[39m suelto variable con_azúcar ## [90m 7[39m bolsas variable con_azúcar ## [90m 8[39m mixto fino sin_azúcar ## [90m 9[39m bolsas marca con_azúcar ## [90m10[39m mixto marca sin_azúcar Nos interesa ver qué personas compran té suelto, y de qué tipo. Empezamos por ver las proporciones que compran té según su empaque (en bolsita o suelto): precio &lt;- te %&gt;% group_by(precio) %&gt;% tally() %&gt;% mutate(prop = round(100 * n / sum(n))) %&gt;% select(-n) tipo &lt;- te %&gt;% group_by(presentacion) %&gt;% tally() %&gt;% mutate(pct = round(100 * n / sum(n))) tipo %&gt;% formatear_tabla presentacion n pct bolsas 170 57 mixto 94 31 suelto 36 12 La mayor parte de las personas toma té en bolsas. Sin embargo, el tipo de té (en términos de precio o marca) que compran es muy distinto dependiendo de la presentación: tipo &lt;- tipo %&gt;% select(presentacion, prop_presentacion = pct) tabla_cruzada &lt;- te %&gt;% group_by(presentacion, precio) %&gt;% tally() %&gt;% # porcentajes por presentación group_by(presentacion) %&gt;% mutate(prop = round(100 * n / sum(n))) %&gt;% select(-n) tabla_cruzada %&gt;% pivot_wider(names_from = presentacion, values_from = prop, values_fill = list(prop = 0)) %&gt;% formatear_tabla() precio bolsas mixto suelto marca 41 21 14 barato 3 1 3 marca_propia 9 4 3 desconocido 6 1 0 fino 8 20 56 variable 32 52 25 Estos datos podemos examinarlos un rato y llegar a conclusiones. Notemos que el uso de tablas no permite mostrar claramente patrones. Tampoco por medio de gráficas como siguiente: ggplot(tabla_cruzada %&gt;% ungroup %&gt;% mutate(price = fct_reorder(precio, prop)), aes(x = precio, y = prop, group = presentacion, colour = presentacion)) + geom_point() + coord_flip() + geom_line() En lugar de eso, calcularemos perfiles columna. Esto es, comparamos cada una de las columnas con la columna marginal (en la tabla de tipo de estilo de té): num_grupos &lt;- n_distinct(te %&gt;% select(presentacion)) tabla &lt;- te %&gt;% group_by(presentacion, precio) %&gt;% tally() %&gt;% group_by(presentacion) %&gt;% mutate(prop_precio = (100 * n / sum(n))) %&gt;% group_by(precio) %&gt;% mutate(prom_prop = sum(prop_precio)/num_grupos) %&gt;% mutate(perfil = 100 * (prop_precio / prom_prop - 1)) tabla ## [90m# A tibble: 17 x 6[39m ## [90m# Groups: precio [6][39m ## presentacion precio n prop_precio prom_prop perfil ## [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;fct&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m ## [90m 1[39m bolsas marca 70 41.2 25.4 61.8 ## [90m 2[39m bolsas barato 5 2.94 2.26 30.1 ## [90m 3[39m bolsas marca_propia 16 9.41 5.48 71.7 ## [90m 4[39m bolsas desconocido 11 6.47 2.51 158. ## [90m 5[39m bolsas fino 14 8.24 28.0 -[31m70[39m[31m.[39m[31m6[39m ## [90m 6[39m bolsas variable 54 31.8 36.3 -[31m12[39m[31m.[39m[31m5[39m ## [90m 7[39m mixto marca 20 21.3 25.4 -[31m16[39m[31m.[39m[31m4[39m ## [90m 8[39m mixto barato 1 1.06 2.26 -[31m52[39m[31m.[39m[31m9[39m ## [90m 9[39m mixto marca_propia 4 4.26 5.48 -[31m22[39m[31m.[39m[31m4[39m ## [90m10[39m mixto desconocido 1 1.06 2.51 -[31m57[39m[31m.[39m[31m6[39m ## [90m11[39m mixto fino 19 20.2 28.0 -[31m27[39m[31m.[39m[31m8[39m ## [90m12[39m mixto variable 49 52.1 36.3 43.6 ## [90m13[39m suelto marca 5 13.9 25.4 -[31m45[39m[31m.[39m[31m4[39m ## [90m14[39m suelto barato 1 2.78 2.26 22.9 ## [90m15[39m suelto marca_propia 1 2.78 5.48 -[31m49[39m[31m.[39m[31m3[39m ## [90m16[39m suelto fino 20 55.6 28.0 98.4 ## [90m17[39m suelto variable 9 25 36.3 -[31m31[39m[31m.[39m[31m1[39m tabla_perfil &lt;- tabla %&gt;% select(presentacion, precio, perfil, pct = prom_prop) %&gt;% pivot_wider(names_from = presentacion, values_from = perfil, values_fill = list(perfil = -100.0)) if_profile &lt;- function(x){ any(x &lt; 0) &amp; any(x &gt; 0) } marcar &lt;- marcar_tabla_fun(25, &quot;red&quot;, &quot;black&quot;) tab_out &lt;- tabla_perfil %&gt;% arrange(desc(bolsas)) %&gt;% select(-pct, everything()) %&gt;% mutate_if(if_profile, marcar) %&gt;% knitr::kable(format = &quot;html&quot;, escape = F, digits = 0) %&gt;% kableExtra::kable_styling(bootstrap_options = c( &quot;hover&quot;, &quot;condensed&quot;), full_width = FALSE) tab_out precio bolsas mixto suelto pct desconocido 157.641196013289 -57.641196013289 -100 3 marca_propia 71.6967570081604 -22.3711470973743 -49.325609910786 5 marca 61.8106471150781 -16.389635229291 -45.4210118857871 25 barato 30.0871348026653 -52.9472065607381 22.8600717580728 2 variable -12.4877880581576 43.6124360668927 -31.1246480087351 36 fino -70.5895012167464 -27.8146572417104 98.4041584584568 28 Leemos esta tabla como sigue: por ejemplo, los compradores de té suelto compran té fino a una tasa casi el doble (98%) que el promedio. También podemos graficar como: tabla_graf &lt;- tabla_perfil %&gt;% ungroup %&gt;% mutate(precio = fct_reorder(precio, bolsas)) %&gt;% select(-pct) %&gt;% pivot_longer(cols = -precio, names_to = &quot;presentacion&quot;, values_to = &quot;perfil&quot;) g_perfil &lt;- ggplot(tabla_graf, aes(x = precio, xend = precio, y = perfil, yend = 0, group = presentacion)) + geom_point() + geom_segment() + facet_wrap(~presentacion) + geom_hline(yintercept = 0 , colour = &quot;gray&quot;)+ coord_flip() g_perfil Observación: hay dos maneras de construir la columna promedio: tomando los porcentajes sobre todos los datos, o promediando los porcentajes de las columnas. Si los grupos de las columnas están desbalanceados, estos promedios son diferentes. Cuando usamos porcentajes sobre la población, perfiles columna y renglón dan el mismo resultado Sin embargo, cuando hay un grupo considerablemente más grande que otros, las comparaciones se vuelven vs este grupo particular. No siempre queremos hacer esto. Interpretación En el último ejemplo de tomadores de té utilizamos una muestra de personas, no toda la población de tomadores de té. Eso quiere decir que tenemos cierta incertidumbre de cómo se generalizan o no los resultados que obtuvimos en nuestro análisis a la población general. Nuestra respuesta depende de cómo se extrajo la muestra que estamos considerando. Si el mecanismo de extracción incluye algún proceso probabilístico, entonces es posible en principio entender qué tan bien generalizan los resultados de nuestro análisis a la población general, y entender esto depende de entender qué tanta variación hay de muestra a muestra, de todas las posibles muestras que pudimos haber extraido. En las siguiente secciones discutiremos estos aspectos, en los cuales pasamos del trabajo de “detective” al trabajo de “juez” en nuestro trabajo analítico. Referencias "],
["referencias.html", "Referencias", " Referencias "]
]
